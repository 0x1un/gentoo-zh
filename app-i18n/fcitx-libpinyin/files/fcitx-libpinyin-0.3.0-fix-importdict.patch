From 7a68b40e36bd3425dae847a3860057a951ec5e78 Mon Sep 17 00:00:00 2001
From: Weng Xuetian <wengxt@gmail.com>
Date: Tue, 2 Jul 2013 20:41:34 -0400
Subject: [PATCH] [libpinyin] fix import if importdict doesn't exist

---
 dictmanager/dictmanager.cpp   | 3 ++-
 dictmanager/scelconverter.cpp | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/dictmanager/dictmanager.cpp b/dictmanager/dictmanager.cpp
index 2858cc9..a7f9326 100644
--- a/dictmanager/dictmanager.cpp
+++ b/dictmanager/dictmanager.cpp
@@ -149,7 +149,8 @@ void DictManager::importFromFile()
     }
 
     char* fullname;
-    FcitxXDGGetFileUserWithPrefix(m_model->dictDir().toLocal8Bit(), importName.append(".txt").toLocal8Bit(), NULL, &fullname);
+    FcitxXDGMakeDirUser(m_model->dictDir().toLocal8Bit().constData());
+    FcitxXDGGetFileUserWithPrefix(m_model->dictDir().toLocal8Bit().constData(), importName.append(".txt").toLocal8Bit(), NULL, &fullname);
     if (!QFile::copy(name, QString::fromLocal8Bit(fullname))) {
         QMessageBox::warning(this, _("Copy file failed"), _("Copy file failed. Please check you have permission or disk is not full."));
     } else {
diff --git a/dictmanager/scelconverter.cpp b/dictmanager/scelconverter.cpp
index 9b23847..44b3725 100644
--- a/dictmanager/scelconverter.cpp
+++ b/dictmanager/scelconverter.cpp
@@ -80,6 +80,7 @@ void ScelConverter::finished(int exitCode, QProcess::ExitStatus status)
     }
 
     char* fullName;
+    FcitxXDGMakeDirUser("libpinyin/importdict");
     FcitxXDGGetFileUserWithPrefix("libpinyin/importdict", m_name.toLocal8Bit().constData(), NULL, &fullName);
 
     if (QFile::rename(m_file.fileName(), QString::fromLocal8Bit(fullName))) {
@@ -87,7 +88,7 @@ void ScelConverter::finished(int exitCode, QProcess::ExitStatus status)
     } else {
         QFile::remove(m_file.fileName());
         emit message(QMessageBox::Warning, _("Rename failed."));
-        emit finished(true);
+        emit finished(false);
     }
 
     free(fullName);
-- 
1.8.1.6

